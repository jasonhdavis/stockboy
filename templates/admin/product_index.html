{% extends 'admin/master.html' %}
{% block body %}
{{ super() }}
{% if current_user.is_authenticated %}


<!-- Content Header (Page header) -->

<section class="content">

  <div class="row">
    <!-- Left col -->
    <section class="container">
        <section class="content-header">

          <h1>Products</h1>
            <small>Top Selling Products, similar to sales chart, but organized to illustrate how successful particular products are</small>

          <ol class="breadcrumb">
              <li><a href="#"><i class="fa fa-dashboard"></i> Dashboard</a></li>
              <li class="active">Products</li>
          </ol>
          {% include 'admin/daterange.html' %}

        </section>

        </section>
        <section class="content">
          <!-- Small boxes (Stat box) -->
          <div class="row">
            <div class="col-lg-3 col-xs-6">
              <!-- small box -->
              <div class="small-box bg-success">
                <div class="inner">
                  <h3>${{ "{:,.2f}".format(top[0]) }}</h3>
                  <p>Sales</p>
              </div>
              <div class="icon">
                  <i class="ion ion-pricetag"></i>
              </div>
              <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
          </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-xs-6">
          <!-- small box -->
          <div class="small-box bg-info">
            <div class="inner">
              <h3>{{"{:,}".format(top[1])}}</h3>

              <p>Qty Sold</p>
          </div>
          <div class="icon">
              <i class="ion ion-stats-bars"></i>
          </div>
          <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-xs-6">
          <!-- small box -->
          <div class="small-box bg-warning">
            <div class="inner">
              <h3>{{"{:,}".format(top[2])}}</h3>

              <p>Orders</p>
          </div>
          <div class="icon">
              <i class="ion ion-filing"></i>
          </div>
          <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-xs-6">
          <!-- small box -->
          <div class="small-box bg-danger">
            <div class="inner">
              <h3>{{"{:,.2f}".format(top[3])}}</h3>

              <p>Items Sold Per Order</p>
          </div>
          <div class="icon">
              <i class="ion ion-bonfire"></i>
          </div>
          <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
        </div>
        <!-- ./col -->
        </div>
        <!-- /.row -->
        <!-- Main row -->
        <div class="row">
          <canvas id="productbarchart"></canvas>
          <button onclick="exportTableToCSV('stockboy-report.csv')">Export Table To CSV</button>
          <table id="dtBasicExample" class="table table-striped table-bordered table-sm">
            <thead>
                <tr>
                    <th class="th-sm">Sku</th>
                    <th class="th-sm">Name</th>
                    <th class="th-sm">QTY</th>
                    <th class="th-sm">Daily Burn Rate</th>
                    <th class="th-sm">Sales</th>
                </tr>
            </thead>
            <tbody >
              {% for item in orders %}
                <tr>
                    <td>{{item[0]}}</td>
                    <td width="50%"><a href="../product/{{item[0]}}">{{item[1]}}</a></td>
                    <td width="10%">{{ "{:,}".format(item[3]) }}</td>
                    <td width="10%">{{item[4]}}</td>
                    <td width="20%">${{ "{:,.2f}".format(item[2]) }}</td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
          </div>

    </section>
    <!-- /.Left col -->

  </div>
  <!-- /.row (main row) -->

</section>
<!-- /.content -->

  {% endif %}

  {% endblock body %}

  {% block tail %}
  <script>

    $(document).ready(function () {
      $('#dtBasicExample').DataTable({
       "paging": false, // false to disable pagination (or any other option)
       "order":[[3, "desc"]],
       "language":{
         "search":"",
         "searchPlaceholder":"Search. . ."
        }
        });
    $('.dataTables_length').addClass('bs-select');
  });


  // Product Bar Chart Canvas

  var productindexbar = document.getElementById("productbarchart").getContext("2d");
  var productData = {
    labels: [
      {% for label in labels %}
        '{{ label }}',
      {% endfor %}
    ],
    datasets : [{
      backgroundColor: "rgba(59, 96, 175, 0.8)",
      pointBackgroundColor: "rgba(59, 96, 175, 0.8)",

      data : [
        {% for value in values %}
          {{ "%.2f" % value  }},
        {% endfor %}
        ]
      }]
    }
  var productBarChart = new Chart(productindexbar, {
    type:'bar',
    data:productData,
    options: {
      responsive: true,
      legend:{
        display: false,
    },
    scales: {
      xAxes:[{
        ticks:{
          display: false
        }
      }]
    }
  }
  });
  </script>
  {% endblock tail %}
