
{% extends 'admin/master.html' %}

{% block body %}
{{ super() }}

{% if current_user.is_authenticated %}

{% set ssd = session['sku_sales_dict']  %}
{% set fba_dict = session['fba_dict'] %}
{% set inventory_dict = session['inventory_dict'] %}
{% set product_dict = session['product_dict'] %}
{% set top_bar = session['top_bar']  %}


<!-- Content Header (Page header) -->
<section class="content-header">
  <ol class="breadcrumb">
    <li><a href="../../../dashboard"><i class="fa fa-dashboard"></i>Dashboard</a></li>
    <li><a href="../../sales"><i class="fa fa-shopping-bag"></i>Sales</a></li>
    <li><a href="../orders"><i class="fa fa-shopping-bag"></i>Orders</a></li>
    <li class="active">{{orderId}}</li>  </ol>

    <h1 style="clear:both;">
      Order Id: {{orderId}}
    </h1>
    {% set this_order = session['orders_dict'][orderId]%}

    {% set storeId = this_order['advancedOptions']['storeId']%}

    {% include 'admin/daterange.html' %}
    <br><br><hr style="clear:both;"><br>
<h2>Order Details</h2>
<div class="col-sm-4 float-left">
  <h4 style="border-bottom:#000 1px solid">Order Data</h4>
  <h4>Store: {{ session['store_dict'][storeId]['storeName']}}</h4>
  <h4>Order Date: {{this_order['orderDate']}}</h4>
  <h4>Order Number: {{this_order['orderNumber']}}</h4>

  </div>
  <div class="col-sm-4 float-left">
  <h4 style="border-bottom:#000 1px solid">Customer</h4>
  <h5>Ship To:</h5>
  <h4>{{ this_order['shipTo']['name']}}</h4>
  <h4>{{ this_order['shipTo']['street1'] }}
    {% if this_order['shipTo']['street2'] %}
    <br>{{ this_order['shipTo']['street2'] }}
    {% endif %}
    {% if this_order['shipTo']['street3'] %}
    <br>{{ this_order['shipTo']['street3'] }}
    {% endif %}
  </h4>
  <h4>{{this_order['shipTo']['city']}},{{this_order['shipTo']['state']}} {{this_order['shipTo']['postalCode']}}</h4>
  <h4>{{this_order['shipTo']['country']}}</h4>

  </div>
  <div class="col-sm-4 float-left">
    <h4 style="border-bottom:#000 1px solid">Shipment</h4>
    <div id="supplier_details_static">

      </div>


  </div>

</section>


<section class="content">

  <!--TOP BAR STAT BOXES -->
  <div class="row">
{% import 'admin/parts.html' as parts %}

  {% set value = '$'+ "{:,.2f}".format(this_order['orderTotal']) %}
  {{ parts.smallbox('Order Total', value=this_order['orderTotal'], color='bg-success' )}}

  {% set shipping = '$'+ "{:,.2f}".format(this_order['shippingAmount']) %}

  {{ parts.smallbox('Shipping Charged', value=shipping, color='bg-info' )}}

  {% set ns=namespace(qty= 0) %}

  {{ parts.smallbox('Qty', value="{:,}".format(session['top_bar']['shipped_to_amz']), color='bg-warning' )}}

  {{ parts.smallbox('Status', value=this_order['orderStatus']) }}


<!-- ./col -->


</div>
        <!-- /.row -->
        <!-- Main row -->
        <canvas id="chart"></canvas>
        <div class="row">
          <div class="col-md-12 col-12">
            <h3>Items</h3>
          <table id="dtBasicExample" class="table table-striped table-bordered table-sm">
            <thead>
                <tr>
                  <th>SKU</th>

                    <th>Name</th>
                    <th>Qty</th>
                    <th>Unit Price</th>
                </tr>
            </thead>
            <tbody >
                <tr>

                    {% for item in this_order['items'] %}
                    <td width="25%">{{ item['sku'] }}<br>
                      <img src="{{ item['imageUrl'] }}" width="100px">
                    </td>

                    <td width="15%">{{ item['name'] }},</td>
                    {% set ns.qty= ns.qty + item['quantity']%}
                    <td width="10%">{{item['quantity']}}</td>
                    <td width="10%">{{item['unitPrice']}}</td>

                    {% endfor %}


                </tr>
            </tbody>
        </table>

</div>

    </section>
    <!-- /.Left col -->

  </div>
  <!-- /.row (main row) -->

</section>
<!-- /.content -->
{% else %}

<center>
  <section class="content" style="color: white">
    <div class="col-sm-12">
      <h1>Flask-Admin example</h1>
      <p class="lead">
        Authentication
      </p>
      <p>
        This example shows how you can use Flask-Admin in an admin template, <br> here I used AdminLTE and <a href="https://pythonhosted.org/Flask-Security/index.html" target="_blank">Flask-Security</a> for authentication.
      </p>
      {% if not current_user.is_authenticated %}

      <p>You can register as a regular user, or log in as a superuser with the following credentials: <br><br>

        email: <b>admin</b> <br>
        password: <b>admin</b> <br>
        <br>
        <p>
          <a class="btn btn-primary" href="{{ url_for('security.login') }}">Login</a> <a class="btn btn-default" href="{{ url_for('security.register') }}">Register</a>
        </p>
        {% endif %}
        <br>
        <p>
          <a class="btn btn-primary" href="/"><i class="glyphicon glyphicon-chevron-left"></i> Back</a>
        </p>
      </div>
    </section>
  </center>

  <br><br><br><br><br><br><br><br><br>
  <br><br><br><br><br><br><br><br><br><br>
  {% endif %}

  {% endblock body %}

  {% block tail %}

  {{ parts.chartglobals() }}
  {{ parts.piechart(dict=session['store_sales_dict'], label_key='name', value_key='sales', element="markets", round=True)}}
  <script>
      // line chart canvas
      var mychart = document.getElementById("chart").getContext("2d");

              // bar chart data

              var gradientFill = mychart.createLinearGradient(0,500,0,300);
              gradientFill.addColorStop(0, "rgba(56, 96, 175, 0.5)");
              gradientFill.addColorStop(1, "rgba(56, 96, 175, 0.7)");
              // draw bar chart
              //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");
              //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");
              //gradientFill.addColorStop(0, "rgba(84,184,143,0.6)");
              //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");

              var lineData = {
                labels : [
                  {% for label in session['date_range_labels'] %}
                    '{{ label }}',
                  {% endfor %}
                ],
                datasets : [{
                  backgroundColor: gradientFill,
                  pointBackgroundColor: "rgba(56, 96, 175, 1)",
                  pointRadius:3,
                  pointPadding: 3,
                  lineTension: 0.3,

                  data : [
                  {% for year in session['by_day_dict'].values() %}
                  {% for month in year.values() %}
                  {% for day in month.values() %}
                    {{ day['meta']['sales'] | round(2)}},
                  {% endfor %}
                  {% endfor %}
                  {% endfor %}

        ]  }
  ]
      }
      var LineChartDemo = new Chart(mychart, {
        type:'line',
        data:lineData,
        options: {
        pointHitRadius: 100,
        scaleShowVerticalLines: true,
        scaleShowGridLines : true,
        barShowStroke : true,
        scaleShowLabels: true,
        bezierCurve: false,
        responsive: true,
        legend:{
          display: false,
        },
        scales: {
          yAxes:[{
            ticks:{

              beginAtZero: true
            }
          }]
        },
        tooltips: {
             callbacks: {
                 label: function(tooltipItems, data) {
                     return '$' +tooltipItems.yLabel.toFixed(2);
                 }
             }
         }

      }
      });





    </script>

  {% endblock tail %}
