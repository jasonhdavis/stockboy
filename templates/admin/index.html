{% extends 'admin/master.html' %}
{% block body %}
{{ super() }}


<!-- Content Header (Page header) -->
<section class="content-header">
    <h1>
      Dashboard<br>
    <small>Top-level stats to give you an overview of your sales, shipments, products & customers</small>
  </h1>
  <ol class="breadcrumb">
      <li class="active"><a href="#"><i class="fa fa-dashboard"></i>Dashboard</a></li>
  </ol>
  {% include 'admin/daterange.html' %}

</section>

<section class="content">

  <!--TOP BAR STAT BOXES -->
  <div class="row">
{% import 'admin/parts.html' as parts %}
  {% set value = '$'+ "{:,.2f}".format(results['top_bar']['total_sales']) %}

  {{ parts.smallbox('Sales', value=value, color='bg-success' )}}
<!-- ./col -->

{{ parts.smallbox('Qty Sold', value=results['top_bar']['total_qty'], color='bg-info' )}}

{{ parts.smallbox('Shipped to Amazon', value=results['top_bar']['shipped_to_amz'], color='bg-warning' )}}

{{ parts.smallbox('Average Burn Rate', value=results['top_bar']['avg_burn'], color='bg-danger' )}}

</div>
<!-- /.row -->
<!-- Main row -->
<div class="row">

<div class="col-xs-6">
  <h4>Top 5 Products</h4>
  <table id="top-5-products" class="table table-striped table-bordered table-sm">
    <thead>
        <tr>
            <th class="th-sm">SKU</th>
            <th class="th-sm">Name</th>
            <th class="th-sm">Qty</th>
            <th class="th-sm">Sales</th>
            <th class="th-sm">Burn</th>
        </tr>
    </thead>
    <tbody >

      {% for sku in results['sku_sales_sort'] %}
        <tr>
            <td><a href="./product/{{results['sku_sales_dict'][sku[0]]['sku']}}">{{results['sku_sales_dict'][sku[0]]['sku']}}</a></td>
            <td width="50%">{{results['sku_sales_dict'][sku[0]]['name']}}</td>
            <td width="10%">{{ "{:,}".format(results['sku_sales_dict'][sku[0]]['qty']) }}</td>
            <td width="10%">${{ "{:,.2f}".format(results['sku_sales_dict'][sku[0]]['sales']) }}</td>
            <td width="10%">{{ "{:,.2f}".format(results['sku_sales_dict'][sku[0]]['burn']) }}</td>

        </tr>
        {% endfor %}
    </tbody>
  </table>
</div>
<div class="col-xs-6">

<canvas id='marketplace-pie'></canvas>
</div>
<canvas id='category-pie'></canvas>

<canvas id='sales-qty'></canvas>


</div>
{% endblock body %}
{% block tail %}

    <script>
      Chart.defaults.global.animationSteps = 25;
      Chart.defaults.global.tooltips.YPadding = 50;
      Chart.defaults.global.tooltips.titleFontSize = 20;
      Chart.defaults.global.tooltips.bodyFontSize = 20;
      Chart.defaults.global.tooltips.displayColors = false;
      Chart.defaults.global.tooltips.CornerRadius = 2;
      Chart.defaults.global.tooltips.TitleFontStyle = "normal";
      Chart.defaults.global.tooltips.FillColor = "rgba(0,0,0,0.8)";
      Chart.defaults.global.animationEasing = "linear";
      Chart.defaults.global.responsive = true;

      // line chart canvas

      var colors = [
      'rgba(140,225,175,1)','rgba(59,96,175,1)','rgba(254,167,112,1)', ' rgba(255,130,140,1)',
      'rgba(140,225,175,.8)','rgba(59,96,175,.8)','rgba(254,167,112,.8)', ' rgba(255,130,140,.8)',
      'rgba(140,225,175,.5)','rgba(59,96,175,.5)','rgba(254,167,112,.5)', ' rgba(255,130,140,.5)',
      ]
      // draw bar chart
      //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");
      //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");
      //gradientFill.addColorStop(0, "rgba(84,184,143,0.6)");
      //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");


      var market_pie = document.getElementById('marketplace-pie').getContext('2d');



      var marketpiedata = {
        labels : [
          {% for store in results['store_sales_dict'].values() %}
            '{{ store['name'] }}',
          {% endfor %}
        ],
        datasets : [{

          data :
          [ {% for store in results['store_sales_dict'].values() %}
              {{ store['sales'] }},
            {% endfor %}
          ],
          backgroundColor: colors
        }
  ],
  label:'Sales by Marketplace',


      }
      var marketplace_piechart =  {
        type:'pie',
        data:marketpiedata,
        options: {
          responsive: true
        }

      };



      var MarketPieChart = new Chart(market_pie, marketplace_piechart)
    </script>

    <script>

      // line chart canvas

      //var gradientFill = mychart.createLinearGradient(0,500,0,300);
      //gradientFill.addColorStop(0, "rgba(56, 96, 175, 0.5)");
      //gradientFill.addColorStop(1, "rgba(56, 96, 175, 0.7)");
      // draw bar chart
      //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");
      //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");
      //gradientFill.addColorStop(0, "rgba(84,184,143,0.6)");
      //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");
      var category_pie = document.getElementById('category-pie').getContext('2d');

      var categorypiedata = {
        labels : [
          {% for category in results['category_sales_dict'].values() %}
            '{{ category['name'] }}',
          {% endfor %}
        ],
        datasets : [{

          data : [
      {% for category in results['category_sales_dict'].values() %}
              {{ category['sales'] }},
            {% endfor %}]
          ,
          backgroundColor: colors}
  ],
  label:'Sales by Category',
  backgroundColor: [
  'rgba(140,225,175,1)','rgba(59,96,175,1)','rgba(33,125,187,1)','rgba(255,130,140,1)'
  ]

      }
      var category_piechart =  {
        type:'pie',
        data:categorypiedata,
        options: {
          responsive: true
        }

      };

      var CategoryPieChart = new Chart(category_pie, category_piechart)

    </script>

    <script>

      // line chart canvas
      var saleschartelement = document.getElementById('sales-qty').getContext('2d');

      var gradientFill = saleschartelement.createLinearGradient(0,500,0,300);
      gradientFill.addColorStop(0, "rgba(56, 96, 175, 0.5)");
      gradientFill.addColorStop(1, "rgba(56, 96, 175, 0.7)");

      //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");
      //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");
      //gradientFill.addColorStop(0, "rgba(84,184,143,0.6)");
      //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");

      var saleschartdata = {
        labels : [  {% for label in results['date_range_labels']%}

        "{{ label }}",
        {% endfor %}
      ],
        datasets : [{
          backgroundColor: gradientFill,
          pointBackgroundColor: "rgba(56, 96, 175, 1)",
          pointRadius:3,
          pointPadding: 3,
          lineTension: 0.3,
          data : [
          {% for year in results['sales_by_day_dict'].values() %}
          {% for month in year.values() %}
          {% for day in month.values() %}
            {{ day }},
          {% endfor %}
          {% endfor %}
          {% endfor %}
            ]}
        ],
        label:'Sales by Day',
        backgroundColor: [
        'rgba(140,225,175,1)','rgba(59,96,175,1)','rgba(33,125,187,1)','rgba(255,130,140,1)'
        ]

      }



      var sales_qty_chart =  {
        type:'line',
        data:saleschartdata,
        options: {
          pointHitRadius: 100,
          scaleShowVerticalLines: true,
          scaleShowGridLines : true,
          barShowStroke : true,
          scaleShowLabels: true,
          bezierCurve: false,
          responsive: true,
          legend:{
            display: false,
          },
          scales: {
            yAxes:[{
              ticks:{

                beginAtZero: true
              }
            }]
          },
          tooltips: {
               callbacks: {
                   label: function(tooltipItems, data) {
                       return '$' +tooltipItems.yLabel.toFixed(2);
                   }
               }
           }
        }

        };




      var SalesQtyChart = new Chart(saleschartelement,sales_qty_chart)

    </script>


{% endblock tail %}
