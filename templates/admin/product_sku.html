{% extends 'admin/master.html' %}
{% block body %}
{{ super() }}

{% if current_user.is_authenticated %}

<!-- Content Header (Page header) -->

<!-- Content Header (Page header) -->
<section class="content-header">
    {% set ssd = results['sku_sales_dict']  %}
    {% set sku = results['target_sku'] %}
    <img class="product-image" width="150px" src="{{ssd[sku]['img']}}">
    <h1>{{ssd[sku]['name']}}<br>
  </h1>
  <ol class="breadcrumb">
    <li><a href="../../"><i class="fa fa-dashboard"></i>Dashboard</a></li>
    <li><a href="../"><i class="fa fa-shopping-bag"></i>Products</a></li>
    <li class="active">{{sku}}</li>  </ol>
  {% include 'admin/daterange.html' %}

</section>
<section>
  <h2>Product Details</h2>
  <h5>Category: {{ssd[sku]['category']}}</h5>
</section>


<section class="content">

  <!--TOP BAR STAT BOXES -->
  <div class="row">
{% import 'admin/parts.html' as parts %}
  {% set value = '$'+ "{:,.2f}".format(results['sku_sales_dict'][sku]['sales']) %}

  {{ parts.smallbox('Sales', value=value, color='bg-success' )}}
<!-- ./col -->

{{ parts.smallbox('Qty Sold', value="{:,}".format(results['sku_sales_dict'][sku]['qty']), color='bg-info' )}}

{{ parts.smallbox('Shipped to Amazon', value="{:,}".format(results['top_bar']['shipped_to_amz']), color='bg-warning' )}}

{{ parts.smallbox('Avg. Qty / Day', value="{:,.2f}".format(results['sku_sales_dict'][sku]['burn']), color='bg-danger' )}}

</div>
        <!-- /.row -->
        <!-- Main row -->
        <canvas id="chart"></canvas>
        <div class="row">
          <div class="col-md-6 col-6">

          <table id="dtBasicExample" class="table table-striped table-bordered table-sm">
            <thead>
                <tr>

                    <th>Name</th>
                    <th>Qty</th>
                    <th>Sales</th>
                </tr>
            </thead>
            <tbody >
              {% for store in results['store_sales_dict'].values() %}
                <tr>
                    <td width="25%">{{store['name']}}</td>
                    <td width="15%">{{store['qty']}}</td>
                    <td width="25%">${{"{:,.2f}".format(store['sales']) }}</td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
          </div>
          <div class="col-md-6 col-6">
            <canvas id="pie_chart_markets"></canvas>
          </div>
          {{ results['ordered_with'] }}
</div>

    </section>
    <!-- /.Left col -->

  </div>
  <!-- /.row (main row) -->

</section>
<!-- /.content -->
{% else %}

<center>
  <section class="content" style="color: white">
    <div class="col-sm-12">
      <h1>Flask-Admin example</h1>
      <p class="lead">
        Authentication
      </p>
      <p>
        This example shows how you can use Flask-Admin in an admin template, <br> here I used AdminLTE and <a href="https://pythonhosted.org/Flask-Security/index.html" target="_blank">Flask-Security</a> for authentication.
      </p>
      {% if not current_user.is_authenticated %}

      <p>You can register as a regular user, or log in as a superuser with the following credentials: <br><br>

        email: <b>admin</b> <br>
        password: <b>admin</b> <br>
        <br>
        <p>
          <a class="btn btn-primary" href="{{ url_for('security.login') }}">Login</a> <a class="btn btn-default" href="{{ url_for('security.register') }}">Register</a>
        </p>
        {% endif %}
        <br>
        <p>
          <a class="btn btn-primary" href="/"><i class="glyphicon glyphicon-chevron-left"></i> Back</a>
        </p>
      </div>
    </section>
  </center>

  <br><br><br><br><br><br><br><br><br>
  <br><br><br><br><br><br><br><br><br><br>
  {% endif %}

  {% endblock body %}

  {% block tail %}

  {{ parts.chartglobals() }}
  {{ parts.piechart(dict=results['store_sales_dict'], label_key='name', value_key='sales', element="markets")}}
  <script>
      // line chart canvas
      var mychart = document.getElementById("chart").getContext("2d");

              // bar chart data

              var gradientFill = mychart.createLinearGradient(0,500,0,300);
              gradientFill.addColorStop(0, "rgba(56, 96, 175, 0.5)");
              gradientFill.addColorStop(1, "rgba(56, 96, 175, 0.7)");
              // draw bar chart
              //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");
              //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");
              //gradientFill.addColorStop(0, "rgba(84,184,143,0.6)");
              //gradientFill.addColorStop(1, "rgba(128, 182, 244, 0.6)");

              var lineData = {
                labels : [
                  {% for label in results['date_range_labels'] %}
                    '{{ label }}',
                  {% endfor %}
                ],
                datasets : [{
                  backgroundColor: gradientFill,
                  pointBackgroundColor: "rgba(56, 96, 175, 1)",
                  pointRadius:3,
                  pointPadding: 3,
                  lineTension: 0.3,

                  data : [
                  {% for year in results['by_day_dict'].values() %}
                  {% for month in year.values() %}
                  {% for day in month.values() %}
                    {{ day['sales'] }},
                  {% endfor %}
                  {% endfor %}
                  {% endfor %}

        ]  }
  ]
      }
      var LineChartDemo = new Chart(mychart, {
        type:'line',
        data:lineData,
        options: {
        pointHitRadius: 100,
        scaleShowVerticalLines: true,
        scaleShowGridLines : true,
        barShowStroke : true,
        scaleShowLabels: true,
        bezierCurve: false,
        responsive: true,
        legend:{
          display: false,
        },
        scales: {
          yAxes:[{
            ticks:{

              beginAtZero: true
            }
          }]
        },
        tooltips: {
             callbacks: {
                 label: function(tooltipItems, data) {
                     return '$' +tooltipItems.yLabel.toFixed(2);
                 }
             }
         }

      }
      });





    </script>

  {% endblock tail %}
